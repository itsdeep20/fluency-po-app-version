import React, { useState, useEffect, useRef } from 'react';
import { initializeApp } from 'firebase/app';
import {
  getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, signInAnonymously
} from 'firebase/auth';
import {
  getFirestore, collection, addDoc, query, where, getDocs, onSnapshot,
  doc, updateDoc, deleteDoc, serverTimestamp, orderBy
} from 'firebase/firestore';
import {
  Send, Menu, X, CheckCircle, Zap, Swords, Trophy, Briefcase, Coffee, Stethoscope,
  Train, Plane, GraduationCap, Loader2, LayoutDashboard, LogOut, User, Settings, Award, MessageCircle, BookOpen, Target,
  Users, Hash, Play, Info, Check, CheckCheck, Bell, Sparkles, Heart, HelpCircle
} from 'lucide-react';
import { motion, AnimatePresence } from 'framer-motion';
import confetti from 'canvas-confetti';

// --- CONFIGURATION ---
const BACKEND_URL = import.meta.env.VITE_BACKEND_URL;

const firebaseConfig = {
  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: import.meta.env.VITE_FIREBASE_APP_ID
};

// --- INIT FIREBASE ---
let auth, db;
try {
  const app = initializeApp(firebaseConfig);
  auth = getAuth(app);
  db = getFirestore(app);
} catch (e) {
  console.warn("Firebase config error:", e);
}

// --- CONSTANTS ---
const PERSONAS = [
  { id: 'arjun_ind', name: 'Arjun', flag: 'ğŸ—£ï¸', role: 'The Debater' },
  { id: 'priya_ind', name: 'Priya', flag: 'ğŸ‘©â€ğŸ’¼', role: 'The Professional' },
  { id: 'rahul_ind', name: 'Rahul', flag: 'ğŸ’¡', role: 'The Mentor' },
];

const AVATARS = ['ğŸ¦', 'ğŸ¦Š', 'ğŸ¼', 'ğŸ¯', 'ğŸ§', 'ğŸ¦‰', 'ğŸ¦‹', 'ğŸ˜', 'ğŸ¤–', 'ğŸš€', 'â­', 'ğŸ”¥'];

const SIMULATIONS = [
  { id: 'sim_train', cat: 'Travel', title: 'Train Station', icon: Train, desc: 'Buy tickets & find platform.' },
  { id: 'sim_airport', cat: 'Travel', title: 'Airport Security', icon: Plane, desc: 'Handle security checks.' },
  { id: 'sim_interview', cat: 'Career', title: 'Job Interview', icon: Briefcase, desc: 'Sell your skills.' },
  { id: 'sim_doctor', cat: 'Health', title: 'Doctor Visit', icon: Stethoscope, desc: 'Describe symptoms.' },
  { id: 'sim_cafe', cat: 'Social', title: 'Coffee Shop', icon: Coffee, desc: 'Order intricate drinks.' },
];
